<% if admin_signed_in? %>
<%= render 'layouts/application/flash_messages' %>
<div class = "alert-info" id="hideMe"style="padding:12px;" >
	<a href="#" class="close" onclick="$('.alert-info').hide();" aria-label="close">&times;</a>
	<div id="embed-api-auth-container"><p>Click the Orange Button to Authorize our Analytics<br> Bill: Login with the email DealsUnlimitedIncAds@gmail.com, the passwords the same as your DealsUnlimitedInc@gmail.com account</p></div>
</div>
<div class="container" style="margin-top:1vmin!important; ">
	<div class="panel panel-default z-depth-4">
		<div class="panel-heading" style="background-color:#ccc">
			<span style="float:right; font-size:3vmin;!important;" id="deals">Dashboard</span>
			<div class="panel-title" style="white-space: nowrap;">
				<span id="deals" style="font-size:3vmin;!important;">Deals </span>
				<span id= "unlimited" style="font-size:3.75vmin;!important;">Unlimited, </span>
				<span id="deals" style="font-size:3vmin;!important;">Inc</span>
			</div>
		</div>
		<div class="panel-body">
			<div class="row" id="dashboard-row" >
				<div class="col-xs-3">
					<table class="table table-striped inverted table-hover table-bordered z-depth-1">
						<thead>
							<tr>
								<td colspan="2">
									<h6 >Info</h6>
								</td>
							</tr>
						</thead>
						<tr>
							<td><label>Total Count</label></td>
							<td><%= Vehicle.count() %></td>
						</tr>
						<tr>
							<td><label>For Sale</label></td>
							<td><%= Vehicle.where(:status => "Sale").count%></td>
						</tr>
						<tr>
							<td><label>Pending</label></td>
							<td><%= Vehicle.where(:status => "Pending").count%></td>
						</tr>
						<tr>
							<td><label>Sold</label></td>
							<td><%= Vehicle.where(:status => "Sold").count%></td>
						</tr>
						<tr>
							<td><label>Last Added on</label></td>
							<td><%= Vehicle.last.created_at.to_date%></td>
						</tr>
					</table>
				</div>
				<div class="col-xs-6">
					<div class="panel panel-default">
						<div class="panel-heading">
							<div class="panel-title">
								<h6>Most Viewed</h6>
							</div>
						</div>
						<div class="panel-body" style="padding:0 .5vmin 0 .5vmin; overflow-y:scroll;">
							<table class="table" style="padding:0; margin:0;">
								<tr>
									<% Vehicle.all.order(:countclicks => "DESC").each do |vehicle| %>
									<% if ((vehicle.countclicks.is_a? Integer) && (vehicle.status == "Sale")) %>
									<td>
										<div class="panel panel-default veh_thumb" style="padding:0; margin:0;">
											<div class="panel-heading" style="padding:0; margin:0;">
												<%= vehicle.year%>
												<%= vehicle.make%>
												<%= vehicle.model%>
											</div>
											<div class="panel-body "  style="padding:0; margin:0;">
												<% if vehicle.import == 'import' %>
												<%=  link_to image_tag(vehicle.image_1, :class=>"veh_thumb_img small"),vehicle %>
												<% elsif ((vehicle.import == nil) && (vehicle.vehicle_images.present?))%>
												<%=  link_to image_tag(vehicle.vehicle_images[0].url, :class=>"veh_thumb_img"),vehicle  %>
												<% end %>
											</div>
											
											<div class="panel-footer" style="padding:0; margin:0;">
												clicks:<%= vehicle.countclicks%>
											</div>
										</div>
									</td>
									
									<% end %>
									<% end %>
								</tr>
							</table>
						</div>
					</div>
				</div>
				<div class="col-xs-3">
					<table class="table table-striped table-hover table-bordered z-depth-1">
						<thead>
							<tr>
								<td colspan="2">
									<h6>Options</h6>
								</td>
							</tr>
						</thead>
						<tr>
							<td  onclick="window.location = '../../vehicles'" class="btn white waves-effect btn-default" style="width:49%!important; color:black; margin-top:.3vmin!important; margin-bottom:.3vmin!important; float:left text-align:center; text-transform:none;">
								Vehicles
							</td>
							<td onclick="window.location = '../../vehicles/new'" class="btn white waves-effect waves-green btn-default" style="width:49%!important;  margin-top:.3vmin!important; margin-bottom:.3vmin!important; color:black; float:right; text-align:center; text-transform:none;">
								+
							</td>
						</tr>
						
						<tr>
							<td colspan="1"  class="btn white waves-effect btn-default" data-toggle="modal" data-target="#myModal" rel="nofollow" style="width:100%!important; margin-bottom:.3vmin!important; color:black;  text-transform:none;">
								Menu
							</td>
						</tr>
						<tr>
							<a class="" style="display:none;" id="logout_handle" rel="nofollow" data-method="delete" href="/admins/sign_out">Logout</a>
							<td colspan="1" onclick="$('#logout_handle').click()" rel="nofollow" class="btn white waves-effect btn-default" style="width:100%!important; color:black; text-transform:none;  ">
								Logout
							</td>
							
						</tr>
					</table>
					
				</div>
			</div>
			<div class="row" id="dashboard-row" >
				<div class="col-xs-4">
					<div class="panel panel-default">
						<div class="panel-heading">
							<div class="panel-title">
								<h6>Top Cities
								Last 30 days</h6>
							</div>
						</div>
						<div class="panel-body" style="padding:0 .5vmin 0 .5vmin;">
							<div id="chart-3-container"></div>
							<div class="view-selector" id="view-selector-3-container"></div>
						</div>
						<div class="panel-footer">
						</div>
					</div>
				</div>
				<div class="col-xs-8">
					<div class="panel panel-default">
						<div class="panel-heading">
							<div class="panel-title">
								<h6>Sessions
								Last 30 days</h6>
							</div>
						</div>
						<div class="panel-body" style="padding:0 1vmin 0 1vmin;">
							<div id="chart-container"></div>
							<div class="view-selector" id="view-selector-container"></div>
						</div>
						<div class="panel-footer">
						</div>
					</div>
				</div>
			</div>
			<div class="row" id="dashboard-row" >
				<div class="col-xs-4">
					<div class="panel panel-default">
						<div class="panel-heading">
							<div class="panel-title">
								<h6>Top Countries
								Last 30 days</h6>
							</div>
						</div>
						<div class="panel-body" style="padding:0 .5vmin 0 .5vmin;">
							<div id="chart-2-container"></div>
							<div class="view-selector" id="view-selector-2-container"></div>
						</div>
						<div class="panel-footer">
						</div>
					</div>
				</div>
				<div class="col-xs-8">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h6 style="float:right;">Click a Browser</h6>
							<div class="panel-title">
								<h6>Browser Distribution</h6>
							</div>
						</div>
						<div class="panel-body" style="padding:0 .5vmin 0 .5vmin;">
							<div class="view-selector"  id="view-selector-container-3"></div>
							<div id="main-chart-container" style="width:48%; float:left;"></div>
							<div id="breakdown-chart-container" style="width:48%; float:right;"> </div>
						</div>
						<div class="panel-footer">
						</div>
					</div>
				</div>
			</div>
			<div class="row" id="dashboard-row" >
			</div>
		</div>
	</div>
</div>
<% else %>
<script type="text/javascript">window.location = "../../login";
</script>
<% end %>
<style>
.veh_thumb_box{
	max-width:auto;
	height:100px;
	margin-bottom:0;
}
.veh_thumb_img{
	max-width:auto;
	height:115px;
}
.small{
		max-height:115px;
}
.dash_buttons{
	font-size:1.7vmin!important;
	width:100%!important;
	text-transform: none!important;
	color:white!important;
	font-weight:normal!important;
	}
#logout-btn, nav{
	display:none;
}
h6{
	white-space: nowrap;
}
.view-selector{
	display:none;
}
footer {
display: none!important;
}
#dashboard-row {
margin-bottom: 0;
}
#no-padding {
margin: 0;
padding: 0;
}
</style>
<script>
(function(w, d, s, g, js, fs) {
g = w.gapi || (w.gapi = {});
g.analytics = {
q: [],
ready: function(f) {
this.q.push(f);
}
};
js = d.createElement(s);
fs = d.getElementsByTagName(s)[0];
js.src = 'https://apis.google.com/js/platform.js';
fs.parentNode.insertBefore(js, fs);
js.onload = function() {
g.load('analytics');
};
}(window, document, 'script'));
gapi.analytics.ready(function() {
gapi.analytics.auth.authorize({
container: 'embed-api-auth-container',
clientid: '563220505800-3laqqiu7ho2jhbotinf0vdb1bhq20dmm.apps.googleusercontent.com'
});
var viewSelector = new gapi.analytics.ViewSelector({
container: 'view-selector-container'
});
var viewSelector2 = new gapi.analytics.ViewSelector({
container: 'view-selector-2-container'
});
var viewSelector3 = new gapi.analytics.ViewSelector({
container: 'view-selector-3-container'
});
viewSelector.execute();
viewSelector2.execute();
viewSelector3.execute();
var dataChart = new gapi.analytics.googleCharts.DataChart({
query: {
metrics: 'ga:sessions',
dimensions: 'ga:date',
'start-date': '30daysAgo',
'end-date': 'yesterday'
},
chart: {
container: 'chart-container',
type: 'LINE',
options: {
width: '100%'
}
}
});
var dataChart2 = new gapi.analytics.googleCharts.DataChart({
query: {
metrics: 'ga:sessions',
dimensions: 'ga:country',
'start-date': '30daysAgo',
'end-date': 'yesterday',
'max-results': 8,
sort: '-ga:sessions'
},
chart: {
container: 'chart-2-container',
type: 'BAR',
options: {
width: '100%',
}
}
});
var dataChart3 = new gapi.analytics.googleCharts.DataChart({
query: {
metrics: 'ga:sessions',
dimensions: 'ga:city',
'start-date': '30daysAgo',
'end-date': 'yesterday',
'max-results': 8,
sort: '-ga:sessions'
},
chart: {
container: 'chart-3-container',
type: 'PIE',
options: {
width: '100%',
pieHole: 4 / 9
}
}
});
viewSelector.on('change', function(ids) {
dataChart.set({
query: {
ids: ids
}
}).execute();
});
viewSelector2.on('change', function(ids) {
dataChart2.set({
query: {
ids: ids
}
}).execute();
});
viewSelector3.on('change', function(ids) {
dataChart3.set({
query: {
ids: ids
}
}).execute();
});
var viewSelector3 = new gapi.analytics.ViewSelector({
container: 'view-selector-container-3'
});
viewSelector3.execute();
var mainChart = new gapi.analytics.googleCharts.DataChart({
query: {
'dimensions': 'ga:browser',
'metrics': 'ga:sessions',
'sort': '-ga:sessions',
'max-results': '6'
},
chart: {
type: 'TABLE',
container: 'main-chart-container',
options: {
width: '100%'
}
}
});
var breakdownChart = new gapi.analytics.googleCharts.DataChart({
query: {
'dimensions': 'ga:date',
'metrics': 'ga:sessions',
'start-date': '7daysAgo',
'end-date': 'yesterday'
},
chart: {
type: 'LINE',
container: 'breakdown-chart-container',
options: {
width: '100%'
}
}
});
var mainChartRowClickListener;
viewSelector3.on('change', function(ids) {
$('#hideMe').fadeOut();
var options = {
query: {
ids: ids
}
};
if (mainChartRowClickListener) {
google.visualization.events.removeListener(mainChartRowClickListener);
}
mainChart.set(options).execute();
breakdownChart.set(options);
if (breakdownChart.get().query.filters) breakdownChart.execute();
});
mainChart.on('success', function(response) {
var chart = response.chart;
var dataTable = response.dataTable;
mainChartRowClickListener = google.visualization.events
.addListener(chart, 'select', function(event) {
if (!chart.getSelection().length) return;
var row = chart.getSelection()[0].row;
var browser = dataTable.getValue(row, 0);
var options = {
query: {
filters: 'ga:browser==' + browser
},
chart: {
options: {
title: browser
}
}
};
breakdownChart.set(options).execute();
$('#breakdown-chart-container').slideDown();
});
});
});
</script>